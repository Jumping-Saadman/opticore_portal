<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Bill</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <style>
        /* Custom font import for aesthetics */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* Background from the original div */
            background-image: linear-gradient(to bottom right, #0F172A, #064E3B, #083344);
        }

        /* Date Picker specific styles */
        .day {
            width: 40px; /* Equivalent to w-10 */
            height: 40px; /* Equivalent to h-10 */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px; /* Equivalent to rounded-full */
            font-size: 0.875rem; /* Equivalent to text-sm */
            cursor: pointer;
            transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, transform;
            transition-duration: 150ms;
        }
        .day:hover:not(.disabled):not(.selected) {
            background-color: #4B5563; /* bg-gray-600 */
        }
        .selected {
            background-color: #10B981; /* bg-emerald-500 */
            color: white;
            font-weight: 700;
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3), 0 4px 6px -2px rgba(16, 185, 129, 0.3); /* shadow-lg shadow-emerald-500/30 */
        }
        .today {
            border: 2px solid #34D399; /* border-2 border-emerald-400 */
            color: #34D399; /* text-emerald-400 */
            font-weight: 500;
        }

    </style>
</head>
<body>

    <div class="min-h-screen flex items-center justify-center p-6 md:p-8">

        <!-- SINGLE GORGEOUS CARD -->
        <div class="w-full max-w-7xl bg-gray-900/80 backdrop-blur-2xl border border-emerald-500/20 rounded-3xl shadow-2xl p-8 md:p-12 space-y-10
                    transition-all duration-500 hover:shadow-emerald-500/30">

            <!-- Header -->
            <div class="text-center">
                <h1 class="text-5xl md:text-6xl font-extrabold bg-gradient-to-r from-emerald-400 via-cyan-400 to-blue-500
                            bg-clip-text text-transparent drop-shadow-lg animate-pulse">
                    Generate Bill
                </h1>
                <p class="text-gray-400 mt-3 text-lg">Select invoice, set amount, and generate instantly</p>
            </div>

            <!-- Two-Column Layout INSIDE CARD -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                <!-- LEFT: Invoice + Client + Services -->
                <div class="space-y-8">

                    <!-- Invoice Dropdown (Static Content) -->
                    <div class="group">
                        <label for="invoice_select" class="block text-emerald-300 font-semibold mb-2">Invoice Number</label>
                        <select id="invoice_select"
                                class="w-full bg-gray-800/90 backdrop-blur-md border border-gray-700 rounded-xl px-5 py-4 text-gray-200
                                       focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400
                                       transition-all duration-300 shadow-inner hover:border-emerald-500/60 cursor-pointer">
                            <option value="">Select Invoice</option>
                            <!-- Mock Data -->
                            <option value="INV-2025-001">INV-2025-001 (Website Dev)</option>
                            <option value="INV-2025-002">INV-2025-002 (Mobile App)</option>
                            <option value="INV-2025-003">INV-2025-003 (Cloud Services)</option>
                        </select>
                        <span class="text-sm text-red-400 mt-1 block"></span>
                    </div>

                    <!-- HARDCODED CLIENT DETAILS -->
                    <div class="bg-gray-800/70 backdrop-blur-xl border border-emerald-500/30 rounded-2xl p-6 space-y-5
                                shadow-lg transition-all duration-500 hover:shadow-emerald-500/20">
                        <h3 class="text-xl font-bold text-emerald-300 flex items-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h-4m-6 0H5"/>
                            </svg>
                            Client Details
                        </h3>

                        <div>
                            <label class="text-gray-400 text-sm">Company Name</label>
                            <p class="text-lg font-medium text-white mt-1">TechNova Solutions Ltd.</p>
                        </div>
                        <div>
                            <label class="text-gray-400 text-sm">Address</label>
                            <p class="text-gray-300 mt-1">123 Silicon Valley, Suite 404, San Francisco, CA 94105</p>
                        </div>
                        <div>
                            <label class="text-gray-400 text-sm">Contact Person</label>
                            <p class="text-gray-300 mt-1">Sarah Johnson</p>
                        </div>
                        <div>
                            <label class="text-gray-400 text-sm">Phone Number</label>
                            <p class="text-gray-300 mt-1">+1 (555) 123-4567</p>
                        </div>
                    </div>

                    <!-- HARDCODED SERVICES LIST -->
                    <div>
                        <h3 class="text-xl font-bold text-cyan-300 mb-4 flex items-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                            List of Services
                        </h3>
                        <div class="space-y-3 max-h-64 overflow-y-auto pr-2">
                            <!-- Mock Service Loop -->
                            <div class="bg-gray-800/60 backdrop-blur-sm border border-cyan-500/20 rounded-xl p-4
                                        hover:border-emerald-400/60 transition-all duration-300
                                        hover:shadow-lg hover:shadow-emerald-500/10 hover:-translate-y-1">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="font-medium text-white">Website Development</p>
                                        <p class="text-sm text-gray-400">Full-stack React + Laravel</p>
                                    </div>
                                    <span class="text-emerald-400 font-bold">$8,500.00</span>
                                </div>
                            </div>
                            <div class="bg-gray-800/60 backdrop-blur-sm border border-cyan-500/20 rounded-xl p-4
                                        hover:border-emerald-400/60 transition-all duration-300
                                        hover:shadow-lg hover:shadow-emerald-500/10 hover:-translate-y-1">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="font-medium text-white">Mobile App (iOS)</p>
                                        <p class="text-sm text-gray-400">SwiftUI + Firebase</p>
                                    </div>
                                    <span class="text-emerald-400 font-bold">$12,000.00</span>
                                </div>
                            </div>
                            <div class="bg-gray-800/60 backdrop-blur-sm border border-cyan-500/20 rounded-xl p-4
                                        hover:border-emerald-400/60 transition-all duration-300
                                        hover:shadow-lg hover:shadow-emerald-500/10 hover:-translate-y-1">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="font-medium text-white">Cloud Migration</p>
                                        <p class="text-sm text-gray-400">AWS EC2 + RDS Setup</p>
                                    </div>
                                    <span class="text-emerald-400 font-bold">$4,500.00</span>
                                </div>
                            </div>
                            <div class="bg-gray-800/60 backdrop-blur-sm border border-cyan-500/20 rounded-xl p-4
                                        hover:border-emerald-400/60 transition-all duration-300
                                        hover:shadow-lg hover:shadow-emerald-500/10 hover:-translate-y-1">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="font-medium text-white">UI/UX Design</p>
                                        <p class="text-sm text-gray-400">Figma + Prototyping</p>
                                    </div>
                                    <span class="text-emerald-400 font-bold">$3,200.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Billing + Action -->
                <div class="space-y-8">

                    <!-- Amounts -->
                    <div class="grid grid-cols-1 gap-5">
                        <div>
                            <label class="text-cyan-300 font-medium">Contracted Amount</label>
                            <div class="mt-2 bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border border-emerald-500/30
                                        rounded-xl px-5 py-4 text-2xl font-bold text-emerald-400 text-center">
                                $28,200.00
                            </div>
                        </div>

                        <div>
                            <label class="text-cyan-300 font-medium">Due Amount</label>
                            <div class="mt-2 bg-gradient-to-r from-orange-500/10 to-red-500/10 border border-orange-500/30
                                        rounded-xl px-5 py-4 text-2xl font-bold text-orange-400 text-center">
                                $12,700.00
                            </div>
                        </div>

                        <!-- Bill Amount Input -->
                        <div>
                            <label for="amount_input" class="block text-cyan-300 font-medium mb-2">Bill Amount</label>
                            <input type="number" id="amount_input" step="0.01" min="0" value="12700.00"
                                   class="w-full bg-gray-800/90 backdrop-blur-md border border-gray-700 rounded-xl px-5 py-4
                                          text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-400
                                          focus:border-emerald-400 transition-all duration-300 shadow-inner"
                                   placeholder="Enter bill amount">
                            <span class="text-sm text-red-400 mt-1 block"></span>
                        </div>

                        <!-- CALENDAR DATE PICKER -->
                        <div class="w-full">
                            <!-- Input Wrapper (Relative position needed for absolute calendar positioning) -->
                            <div class="relative z-10" id="date-picker-wrapper">
                                <label for="invoice_date_display" class="text-cyan-300 font-medium text-lg">Invoice Date</label>
                                <div class="relative mt-2">
                                    <!-- Hidden Input for actual value (similar to the original wire:model) -->
                                    <input
                                        type="hidden"
                                        id="invoice_date_hidden"
                                        value=""
                                    >

                                    <!-- Visible Input with Calendar Icon -->
                                    <input
                                        type="text"
                                        id="invoice_date_display"
                                        readonly
                                        class="w-full bg-gray-800/90 backdrop-blur-md border border-gray-700 rounded-xl px-5 py-4 pr-12
                               text-white placeholder-gray-500 cursor-pointer
                               focus:outline-none focus:ring-2 focus:ring-emerald-400
                               focus:border-emerald-400 transition-all duration-300 shadow-xl
                               hover:border-emerald-500/60"
                                        placeholder="Select date"
                                        onclick="toggleCalendar()"
                                    >

                                    <!-- Calendar Icon -->
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none">
                                        <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                    </div>
                                </div>

                                <!-- Date Picker Dropdown Container -->
                                <div id="calendar-container" class="absolute top-full mt-2 w-full bg-gray-900 border border-gray-700 rounded-xl shadow-2xl overflow-hidden hidden transition-opacity duration-300 opacity-0 z-20">
                                    <!-- Calendar content will be injected here -->
                                </div>
                            </div>

                            <!-- Placeholder for error messages (optional) -->
                            <div class="text-sm text-red-400 mt-1 block h-5" id="error-message"></div>
                        </div>
                    </div>

                    <!-- Remarks -->
                    <div>
                        <label for="remarks" class="block text-cyan-300 font-medium mb-2">Remarks</label>
                        <div class="relative group">
                            <textarea id="remarks" rows="3"
                                      placeholder="Write any notes, comments, or special instructions here..."
                                      class="w-full bg-gray-800/90 backdrop-blur-md border border-gray-700 rounded-xl p-5
                                             text-gray-200 placeholder-gray-500 resize-none focus:outline-none
                                             focus:ring-2 focus:ring-emerald-400 focus:border-transparent
                                             transition-all duration-300 ease-in-out group-hover:border-emerald-400/50 shadow-inner"></textarea>
                            <div class="absolute inset-0 rounded-xl pointer-events-none opacity-0
                                        group-focus-within:opacity-100 transition-all duration-300
                                        bg-gradient-to-r from-emerald-400/10 via-cyan-400/10 to-blue-400/10 blur-md"></div>
                        </div>
                        <p class="mt-2 text-xs text-gray-500">These notes will be saved for internal reference.</p>
                    </div>

                    <!-- Generate Bill Button -->
                    <div class="flex justify-end">
                        <button onclick="console.log('Bill Generated:', {date: document.getElementById('invoice_date_hidden').value, amount: document.getElementById('amount_input').value, remarks: document.getElementById('remarks').value})"
                                class="group relative inline-flex items-center gap-3 px-8 py-4
                                       bg-gradient-to-r from-emerald-500 to-teal-500
                                       hover:from-emerald-400 hover:to-teal-400
                                       text-white font-bold text-lg rounded-xl
                                       shadow-xl transform transition-all duration-300
                                       hover:scale-105 hover:shadow-emerald-500/50 overflow-hidden">
                            <span>Generate Bill</span>
                            <svg class="w-6 h-6 group-hover:translate-x-1 transition-transform"
                                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M9 12l2 2 4-4"/>
                                <circle cx="12" cy="12" r="10"/>
                            </svg>

                            <!-- Ripple Effect -->
                            <span class="absolute inset-0 rounded-xl">
                                <span class="absolute w-0 h-0 bg-white opacity-30 rounded-full
                                             transform transition-all duration-500
                                             group-active:w-full group-active:h-full
                                             group-active:scale-150"></span>
                            </span>

                            <!-- Lottie Checkmark (Mocked for display) -->
                            <lottie-player
                                src="https://assets3.lottiefiles.com/packages/lf20_qhrudwpm.json"
                                background="transparent" speed="1.5"
                                style="width: 60px; height: 60px; position: absolute; right: -15px; top: -15px; opacity: 0;"
                                loop class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            </lottie-player>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- Date Picker State and Utility Functions ---

        const datePickerWrapper = document.getElementById('date-picker-wrapper');
        const calendarContainer = document.getElementById('calendar-container');
        const displayInput = document.getElementById('invoice_date_display');
        const hiddenInput = document.getElementById('invoice_date_hidden');

        // State variables
        let currentDate = new Date(); // Date object for calendar navigation
        let selectedDate = null; // Date object for selected value
        const today = new Date(); // Constant for today's date
        let calendarView = 'month'; // New state: 'month' or 'year'

        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        /**
         * Formats a Date object into a user-friendly display string (e.g., "Mon, Dec 25, 2025")
         * @param {Date} date
         * @returns {string}
         */
        function formatDateDisplay(date) {
            if (!date) return '';
            const year = date.getFullYear();
            const month = monthNames[date.getMonth()].substring(0, 3);
            const dayNum = date.getDate();
            const dayName = dayNames[date.getDay()];
            return `${dayName}, ${month} ${dayNum}, ${year}`;
        }

        /**
         * Formats a Date object into the ISO-like hidden value (YYYY-MM-DD)
         * @param {Date} date
         * @returns {string}
         */
        function formatDateHidden(date) {
            if (!date) return '';
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        /**
         * Checks if two Date objects represent the same day.
         * @param {Date} d1
         * @param {Date} d2
         * @returns {boolean}
         */
        function isSameDay(d1, d2) {
            if (!d1 || !d2) return false;
            // Normalize time components to ensure only date comparison
            d1 = new Date(d1.getFullYear(), d1.getMonth(), d1.getDate());
            d2 = new Date(d2.getFullYear(), d2.getMonth(), d2.getDate());
            return d1.getTime() === d2.getTime();
        }

        /**
         * Initializes the date picker by setting the initial state from the hidden input.
         */
        function initDatePicker() {
            // Check if there's an existing value in the hidden input
            if (hiddenInput.value) {
                const parts = hiddenInput.value.split('-').map(Number);
                if (parts.length === 3) {
                    // Note: Month is 0-indexed in JS Date object
                    selectedDate = new Date(parts[0], parts[1] - 1, parts[2]);
                    currentDate = new Date(selectedDate); // Start calendar view on selected month
                    displayInput.value = formatDateDisplay(selectedDate);
                }
            } else {
                // Set initial display to today's date if empty
                currentDate = new Date(today);
                // Optionally set today's date as default selected date
                selectedDate = new Date(today);
                hiddenInput.value = formatDateHidden(selectedDate);
                displayInput.value = formatDateDisplay(selectedDate);
            }

            // No need to render immediately, only render upon opening
            // renderCalendar();
        }

        /**
         * Toggles the visibility of the calendar dropdown.
         */
        function toggleCalendar() {
            const isHidden = calendarContainer.classList.contains('hidden');

            if (isHidden) {
                // Ensure calendar is rendered for the correct view (default to month)
                currentDate = selectedDate ? new Date(selectedDate) : new Date(today);
                calendarView = 'month'; // Always start on month view when opening
                renderCalendar();

                // Show calendar with smooth transition
                calendarContainer.classList.remove('hidden');
                requestAnimationFrame(() => {
                    calendarContainer.classList.remove('opacity-0');
                    calendarContainer.classList.add('opacity-100');
                });
            } else {
                // Hide calendar with smooth transition
                calendarContainer.classList.remove('opacity-100');
                calendarContainer.classList.add('opacity-0');
                setTimeout(() => {
                    calendarContainer.classList.add('hidden');
                }, 300);
            }
        }

        // --- Navigation and View Switching ---

        /**
         * Updates the state and re-renders the calendar for the new month.
         * @param {number} delta - +1 for next month, -1 for previous month
         */
        function navMonth(delta) {
            // Set the date to the 1st of the next/previous month to ensure correct month calculation
            currentDate.setDate(1);
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        /**
         * Switches the view to the year selection grid.
         */
        function showYearView() {
            calendarView = 'year';
            renderCalendar();
        }

        /**
         * Switches the view back to the month selection grid.
         */
        function showMonthView() {
            calendarView = 'month';
            renderCalendar();
        }

        /**
         * Navigates the year view grid by decades (12 years).
         * @param {number} delta - +1 for next 12 years, -1 for previous 12 years
         */
        function navYearDecade(delta) {
            currentDate.setFullYear(currentDate.getFullYear() + (delta * 12));
            renderCalendar();
        }

        /**
         * Selects a year from the year grid and returns to month view.
         * @param {number} selectedYr - The selected year
         */
        function selectYear(selectedYr) {
            currentDate.setFullYear(selectedYr);
            calendarView = 'month';
            renderCalendar();
        }

        /**
         * Handles the selection of a specific day.
         * IMPORTANT: The calendar does NOT close here, as requested.
         * @param {number} day - The day number (1-31)
         */
        function selectDate(day, event) {
            if (event) {
                event.stopPropagation(); // Prevent click from bubbling to document
            }

            selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);

            // Update inputs
            hiddenInput.value = formatDateHidden(selectedDate);
            displayInput.value = formatDateDisplay(selectedDate);

            // Re-render to show selection highlight
            renderCalendar();
        }


        // --- Render Functions ---

        /**
         * Renders the standard month view grid.
         */
        function renderMonthView() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthName = monthNames[month];

            const firstDayOfMonth = new Date(year, month, 1);
            const startingDayOfWeek = firstDayOfMonth.getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            let html = `
                <!-- Month/Year Navigation -->
                <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                    <button onclick="navMonth(-1)" title="Previous Month" class="p-2 rounded-full hover:bg-gray-700 transition-colors duration-150 text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                    </button>

                    <!-- Clickable Year/Month Display to trigger Year View -->
                    <div class="text-white text-lg font-semibold cursor-pointer hover:text-emerald-400 transition-colors" onclick="showYearView()">
                        ${monthName} <span class="text-emerald-400 font-bold">${year}</span>
                    </div>

                    <button onclick="navMonth(1)" title="Next Month" class="p-2 rounded-full hover:bg-gray-700 transition-colors duration-150 text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </button>
                </div>

                <!-- Weekdays Row -->
                <div class="grid grid-cols-7 text-center text-sm font-medium text-gray-400 mb-2">
                    ${dayNames.map(day => `<div class="day !w-auto !h-auto !rounded-none">${day}</div>`).join('')}
                </div>

                <!-- Days Grid -->
                <div class="grid grid-cols-7 gap-1 text-center text-gray-200" id="calendar-days-grid">
            `;

            // 3. Add Blanks for the starting day offset
            for (let i = 0; i < startingDayOfWeek; i++) {
                html += `<div class="day disabled"></div>`;
            }

            // 4. Add the Days of the Month
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDayDate = new Date(year, month, day);

                let classes = 'day';

                // Check if this is today
                if (isSameDay(currentDayDate, today)) {
                    classes += ' today';
                }

                // Check if this day is selected
                if (selectedDate && isSameDay(currentDayDate, selectedDate)) {
                    // If it's selected, remove the 'today' class border if present
                    classes = classes.replace('today', '');
                    classes += ' selected';
                }

                // Add the day button with the selectDate handler
                html += `
                    <div
                        class="${classes}"
                        onclick="selectDate(${day})"
                    >
                        ${day}
                    </div>
                `;
            }

            // 5. Close HTML structure
            html += `
                    </div>
            `;
            return html;
        }

        /**
         * Renders the year selection grid for decade navigation.
         */
        function renderYearView() {
            const currentYear = currentDate.getFullYear();
            // Calculate the start year of the current 12-year block
            const startYear = currentYear - (currentYear % 12);
            const startRange = startYear - 5;
            const endRange = startRange + 11;

            let html = `
                <!-- Decade Navigation -->
                <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                    <button onclick="navYearDecade(-1)" title="Previous 12 Years" class="p-2 rounded-full hover:bg-gray-700 transition-colors duration-150 text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/></svg>
                    </button>
                    <div class="text-white text-lg font-semibold cursor-pointer hover:text-cyan-400 transition-colors" onclick="showMonthView()">
                        <span class="text-cyan-400 font-bold">${startRange} - ${endRange}</span>
                    </div>
                    <button onclick="navYearDecade(1)" title="Next 12 Years" class="p-2 rounded-full hover:bg-gray-700 transition-colors duration-150 text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/></svg>
                    </button>
                </div>

                <!-- Year Grid (4 columns, 3 rows for 12 years) -->
                <div class="grid grid-cols-4 gap-2 text-center text-gray-200 p-2">
            `;

            for (let i = 0; i < 12; i++) {
                const year = startRange + i;
                let classes = 'day !w-full !h-12 !rounded-lg hover:bg-gray-700 text-base';

                // Highlight the year currently being navigated
                if (year === currentDate.getFullYear()) {
                    classes += ' bg-emerald-700 text-white font-bold shadow-lg shadow-emerald-500/30 hover:bg-emerald-600';
                }
                // Highlight the year that contains the selected date
                else if (selectedDate && selectedDate.getFullYear() === year) {
                     classes += ' bg-cyan-700 text-white font-bold hover:bg-cyan-600';
                }


                html += `
                    <div
                        class="${classes}"
                        onclick="selectYear(${year})"
                    >
                        ${year}
                    </div>
                `;
            }

            html += `</div>`; // Close grid
            return html;
        }


        /**
         * Core function to dynamically generate and inject the calendar content based on the current view.
         */
        function renderCalendar() {
            let contentHtml = '';

            if (calendarView === 'month') {
                contentHtml = renderMonthView();
            } else if (calendarView === 'year') {
                contentHtml = renderYearView();
            }

            // Inject the generated HTML into the container, wrapped in a padding div
            calendarContainer.innerHTML = contentHtml ? `<div class="p-4">${contentHtml}</div>` : '';
        }

        // --- Event Listeners and Initializer ---

        // NEW LOGIC: Close the calendar only if the click is outside the date picker wrapper.
        document.addEventListener('click', function(event) {
            // Check if the click occurred outside the entire date picker wrapper AND the calendar is visible
            if (!datePickerWrapper.contains(event.target) && !calendarContainer.classList.contains('hidden')) {
                toggleCalendar();
            }
        });

        // Initialize the date picker when the page loads
        window.onload = initDatePicker;

    </script>
</body>
</html>